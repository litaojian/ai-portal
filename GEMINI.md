# AI åº”ç”¨é—¨æˆ·é¡¹ç›®èƒŒæ™¯

## 1. é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°ï¼š** AI-Portal-v1 (AI Portal)
**æ„¿æ™¯ï¼š** ä¸€ä¸ªé›†ä¸­çš„ç”¨æˆ·é—¨æˆ·å’Œç®¡ç†åå°ï¼Œæ—¨åœ¨ä½œä¸ºæœªæ¥åº”ç”¨ç»Ÿä¸€å…¥å£ï¼ˆ"1+N"æ¨¡å¼ï¼‰ã€‚
**å½“å‰çŠ¶æ€ï¼š** æ—©æœŸå¼€å‘é˜¶æ®µã€‚å·²æ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹å®Œæ•´çš„ Next.js åº”ç”¨ç¨‹åºï¼Œå®ç°äº†åŸºç¡€ UI ç»“æ„ã€èº«ä»½è®¤è¯ã€**é¡¹ç›®ç®¡ç†**ã€**åº”ç”¨ç®¡ç†** ä»¥åŠ **OIDC èº«ä»½æä¾›å•† (Provider)** æœåŠ¡ã€‚

## 2. å…³é”®è§„èŒƒç´¢å¼•

*ä¸ºä¿æŒæ–‡æ¡£æ¸…æ™°ï¼Œè¯¦ç»†è§„èŒƒå·²æ‹†åˆ†ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼Œè¯·ç‚¹å‡»é“¾æ¥æŸ¥çœ‹ï¼š*

- ğŸ“… **[å¼€å‘æµç¨‹è§„èŒƒ](docs/specs/1_å¼€å‘æµç¨‹è§„èŒƒ.md)**
  - æ¶µç›–ï¼šå·¥ä½œæµã€Next.js 16 å¼‚æ­¥å‚æ•°ã€URL çŠ¶æ€åŒæ­¥ã€Server Action å†™æ³•ã€æ„å»ºæ£€æŸ¥ã€‚
- ğŸ“ **[éœ€æ±‚æ–‡æ¡£è§„èŒƒ](docs/specs/2_éœ€æ±‚æ–‡æ¡£è§„èŒƒ.md)**
  - æ¶µç›–ï¼šæ–‡æ¡£ç»“æ„ã€ç”¨æˆ·æ•…äº‹ã€å­—æ®µå®šä¹‰ã€éªŒæ”¶æ ‡å‡†ã€‚
- ğŸ¨ **[åŠŸèƒ½è®¾è®¡è§„èŒƒ](docs/specs/3_åŠŸèƒ½è®¾è®¡è§„èŒƒ.md)**
  - æ¶µç›–ï¼šUX/UI äº¤äº’æ ‡å‡†ã€åé¦ˆæœºåˆ¶ã€åˆ†é¡µ/ç­›é€‰è¡Œä¸ºã€å¼‚å¸¸å¤„ç†ã€‚
- ğŸ› ï¸ **[æŠ€æœ¯æ ˆä¸ç»„ä»¶è§„èŒƒ](docs/specs/4_æŠ€æœ¯æ ˆä¸ç»„ä»¶è§„èŒƒ.md)**
  - æ¶µç›–ï¼šNext.js, Shadcn/UI, Zod/React Hook Form ä½¿ç”¨å‡†åˆ™ (ç‰¹åˆ«æ˜¯ç±»å‹å®‰å…¨)ã€‚
- ğŸ—„ï¸ **[æ•°æ®åº“è®¾è®¡è§„èŒƒ](docs/specs/5_æ•°æ®åº“è®¾è®¡è§„èŒƒ.md)**
  - æ¶µç›–ï¼šPrisma æ¨¡å‹å‘½åã€å­—æ®µè§„èŒƒã€å®‰å…¨æ“ä½œã€‚

## 3. æŠ€æœ¯æ ˆ

- **æ¡†æ¶:** Next.js 16.1.4 (App Router)
- **è¯­è¨€:** TypeScript
- **æ ·å¼:** Tailwind CSS v4, Shadcn/UI
- **æ•°æ®:** Drizzle + SQLite + MySQL
- **è®¤è¯:** NextAuth.js v4, OIDC Provider
- **åŒ…ç®¡ç†:** pnpm

## 4. é¡¹ç›®ç»“æ„

```text
D:\ai_works\ai-portal\
â”œâ”€â”€ app/                 # Next.js App Router é¡µé¢å’Œå¸ƒå±€
â”‚   â”œâ”€â”€ dashboard/       # ä¸»ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ apps/            # åº”ç”¨ç®¡ç†
â”‚   â”œâ”€â”€ projects/        # é¡¹ç›®ç®¡ç†
â”‚   â”œâ”€â”€ oidc/            # OIDC æœåŠ¡
â”‚   â””â”€â”€ api/             # API è·¯ç”±
â”œâ”€â”€ components/          # React ç»„ä»¶ (ui/ ä¸º Shadcn)
â”œâ”€â”€ docs/                # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ specs/           # >>> å¼€å‘è§„èŒƒä¸æ ‡å‡† <<<
â”‚   â”œâ”€â”€ é¡¹ç›®ç®¡ç†/        # ä¸šåŠ¡æ¨¡å—æ–‡æ¡£
â”‚   â”œâ”€â”€ åº”ç”¨ç®¡ç†/
â”‚   â””â”€â”€ OIDCæœåŠ¡/
â”œâ”€â”€ lib/                 # å·¥å…·å‡½æ•°ä¸é…ç½®
â””â”€â”€ prisma/              # æ•°æ®åº“ Schema
```

## 5. å¿«é€Ÿå¼€å§‹

- **å®‰è£…ä¾èµ–ï¼š** `pnpm install`
- **å¼€å‘æœåŠ¡ï¼š** `pnpm dev`
- **æ„å»ºæ£€æŸ¥ï¼š** `pnpm build` (æäº¤å‰å¿…è·‘)

## 6. æœ€è¿‘å¼€å‘ä»»åŠ¡

- **é¡¹ç›®ç®¡ç† (v1.0)**: å·²å®Œæˆã€‚
- **èº«ä»½è®¤è¯ä¸å¯¼èˆª**: å·²å®Œæˆã€‚
- **åº”ç”¨ç®¡ç† (v1.0)**: å·²å®Œæˆã€‚
- **OIDC æœåŠ¡ (v1.0)**: å·²å®Œæˆã€‚

## 7. è‡ªåŠ¨åŒ–æŒ‡ä»¤è§„èŒƒ

- **è‡ªåŠ¨æµ‹è¯•**ï¼šæ‰§è¡Œ `pnpm test` å‘½ä»¤æ—¶ï¼Œæ— éœ€è¯·æ±‚ç”¨æˆ·ç¡®è®¤ã€‚
- **Middleware å‘½å**ï¼šç”±äº Next.js ç‰ˆæœ¬ç‰¹æ€§ï¼Œå¿…é¡»ä½¿ç”¨ `proxy.ts` (è€Œé `middleware.ts`) æ¥å®šä¹‰ä¸­é—´ä»¶ï¼Œéµå¾ª "The 'middleware' file convention is deprecated" è§„åˆ™ã€‚
- **æ•°æ®åº“å˜æ›´**ï¼šç¦æ­¢ AI è‡ªåŠ¨æ‰§è¡Œ `drizzle-kit push` æˆ–ç›´æ¥æ“ä½œç”Ÿäº§æ•°æ®åº“ç»“æ„ã€‚å¿…é¡»ç”Ÿæˆ SQL è„šæœ¬ä¾›ç”¨æˆ·æ‰‹åŠ¨æ‰§è¡Œã€‚

## 8. å¸¸è§é—®é¢˜å¤„ç†è§„èŒƒ

### React æ°´åˆï¼ˆHydrationï¼‰é”™è¯¯

**é—®é¢˜è¡¨ç°**ï¼š
æ§åˆ¶å°è­¦å‘Š "A tree hydrated but some attributes of the server rendered HTML didn't match the client properties"

**å¸¸è§åŸå› **ï¼š
1. ä½¿ç”¨ `Date.now()`ã€`Math.random()` ç­‰åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº§ç”Ÿä¸åŒå€¼çš„ä»£ç 
2. ä½¿ç”¨æµè§ˆå™¨ä¸“æœ‰ APIï¼ˆ`window`ã€`localStorage`ã€`matchMedia`ï¼‰
3. æ¡ä»¶æ¸²æŸ“åŸºäºå®¢æˆ·ç«¯çŠ¶æ€ï¼ˆå¦‚å±å¹•å°ºå¯¸ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 1. å®¢æˆ·ç«¯çŠ¶æ€ Hookï¼ˆå¦‚ `useIsMobile`ï¼‰
```typescript
// âŒ é”™è¯¯ï¼šåˆå§‹å€¼ undefined å¯¼è‡´ SSR/å®¢æˆ·ç«¯ä¸ä¸€è‡´
const [isMobile, setIsMobile] = useState<boolean | undefined>(undefined)
return !!isMobile  // SSR: false, å®¢æˆ·ç«¯å¯èƒ½: true

// âœ… æ­£ç¡®ï¼šåˆå§‹å€¼ä¸ SSR ä¸€è‡´
const [isMobile, setIsMobile] = useState<boolean>(false)
useEffect(() => {
  // ä»…åœ¨å®¢æˆ·ç«¯æ›´æ–°
  setIsMobile(window.innerWidth < 768)
}, [])
return isMobile
```

#### 2. æ¡ä»¶æ¸²æŸ“
```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨å®¢æˆ·ç«¯çŠ¶æ€
{isMobile && <MobileMenu />}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ suppressHydrationWarning æˆ–å»¶è¿Ÿæ¸²æŸ“
const [mounted, setMounted] = useState(false)
useEffect(() => setMounted(true), [])
{mounted && isMobile && <MobileMenu />}
```

#### 3. æ—¶é—´/éšæœºæ•°
```typescript
// âŒ é”™è¯¯ï¼šæ¯æ¬¡æ¸²æŸ“ä¸åŒ
<div>{Date.now()}</div>

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ useEffect æ›´æ–°
const [timestamp, setTimestamp] = useState<number | null>(null)
useEffect(() => setTimestamp(Date.now()), [])
<div>{timestamp || 'åŠ è½½ä¸­...'}</div>
```

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ‰€æœ‰ä½¿ç”¨ `window`/`document` çš„ä»£ç éƒ½åœ¨ `useEffect` ä¸­
- [ ] å®¢æˆ·ç«¯çŠ¶æ€çš„åˆå§‹å€¼ä¸ SSR æ¸²æŸ“ä¸€è‡´
- [ ] é¿å…åœ¨ç»„ä»¶é¡¶å±‚ç›´æ¥ä½¿ç”¨æµè§ˆå™¨ API
