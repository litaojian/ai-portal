# 动态页面配置 UI/UX 设计 (v3.0)

## 1. 架构概览：插件化渲染引擎

不再使用硬编码的 `switch(type)`，而是采用 **Registry Pattern**。

### 1.1 组件注册表 (`Registry`)
- **位置**: `components/dynamic-page/registry.tsx`
- **职责**: 维护 `Type -> Component` 的映射关系。
- **扩展性**: 允许模块注册自定义渲染器，如 `registerCellRenderer('user-avatar', UserAvatarComponent)`.

### 1.2 渲染流程
1.  **Loader**: 读取 JSON -> Zod 校验 -> 生成 `PageConfig` 对象。
2.  **Page**: 获取配置 -> 传递给 `DynamicTable` / `DynamicForm`。
3.  **Table**: 遍历 `columns` -> 调用 `getCellRenderer(col.component || field.type)` -> 渲染单元格。

## 2. 核心组件设计

### 2.1 动态表格 (`DynamicTable`)
- **Props**: `{ config: PageConfig, data: any[] }`
- **列渲染逻辑**:
  - 优先检查 `column.component` (视图层覆盖)。
  - 其次检查 `field.type` (模型层定义)。
  - 默认回退到 `TextRenderer`。
- **内置渲染器**:
  - `text`: 基础文本。
  - `number`: 支持 `format: 'currency' | 'percentage'`。
  - `date`: 使用 `date-fns` 统一格式化。
  - `select/enum`: 自动映射为 `Badge` (支持 color 映射)。
  - `boolean`: 映射为 "是/否" Badge。

### 2.2 动态表单 (`DynamicForm`) - (规划中)
- **Props**: `{ config: PageConfig, defaultValues?: any, onSubmit: (data) => void }`
- **布局引擎**: 支持 `Grid` 和 `Section` 分组。
- **校验集成**: 自动将 JSON 中的 `validation` 规则转换为 React Hook Form 的验证规则。

## 3. 权限与可见性 (Permissions)
UI 组件需内置权限检查逻辑 (配合 `useSession`):
- **列可见性**: 如果 `column.permissions` 包含的角色与当前用户不匹配，则该列不渲染。
- **操作按钮**: `actions.row` 和 `actions.toolbar` 中的按钮需根据权限配置禁用或隐藏。

## 4. 响应式策略
- **Mobile First**: 默认使用 Shadcn UI 的响应式组件。
- **表格适配**: 在小屏幕下，`DynamicTable` 可配置为仅显示 `primaryKey` 和 `title` 字段，或自动切换为 `CardList` 模式（待实现）。
