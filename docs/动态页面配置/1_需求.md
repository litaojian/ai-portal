# 动态页面配置系统需求文档 (v3.0)

## 1. 背景与目标
**目标**：构建一个企业级、**配置驱动 (Configuration-Driven)** 的动态业务系统引擎。
**核心价值**：
- **Configuration as Code**: 业务模型通过 Git 管理的 JSON 定义。
- **Type Safety**: 基于 Zod 的严格 Schema 校验，确保配置文件的正确性与类型提示。
- **Plugin Architecture**: 渲染逻辑与核心引擎解耦，支持自定义字段与操作。

## 2. 核心概念
- **Config Schema**: `lib/schemas/page-config.ts` 定义的 Zod 契约。
- **Config Files**: 位于 `config/pages/*.json`，必须通过 Schema 校验。
- **Component Registry**: 前端组件注册中心，动态映射 JSON 类型到 React 组件。
- **Runtime Engine**: 
  - **Loader**: 解析并校验 JSON。
  - **Dynamic Portal**: 基于 Next.js App Router 的通用渲染层。

## 3. 六大核心特性
1.  **配置驱动**: 所有页面行为（字段、视图、校验）由 JSON 定义。
2.  **类型安全**: 完整的 TypeScript 支持，从配置加载到组件渲染全链路类型化。
3.  **插件化架构**: 支持自定义字段类型（如 `Image`, `UserPicker`）和操作。
4.  **权限控制**: 基于角色的细粒度权限管理（字段级、行级、操作级）。
5.  **响应式设计**: 支持移动端和桌面端自适应布局。
6.  **可扩展性**: 易于添加新的字段类型、验证规则和渲染组件。

## 4. 路由设计 (URL Structure)

| 页面类型 | URL 模式 | 示例 |
| :--- | :--- | :--- |
| **列表页** | `/portal/[modelName]` | `/portal/orders` |
| **新建页** | `/portal/[modelName]/new` | `/portal/orders/new` |
| **详情/编辑页** | `/portal/[modelName]/[id]` | `/portal/orders/ORD-2023001` |

## 5. 验收标准
1.  **配置校验**: 加载非法 JSON（如缺少字段、类型错误）时应在服务端抛出明确错误。
2.  **插件渲染**: 表格列应能根据配置的 `type` 或 `component` 字段自动选择正确的渲染器（如 Badge, Date, Currency）。
3.  **权限执行**: 无权限的用户不应看到受控的列或按钮。
4.  **响应式**: 在移动端视图下，表格应自动适配（如隐藏非关键列或切换为卡片视图）。