### **项目需求规格说明书：用户门户与管理后台**

**版本:** 1.0
**日期:** 2026年1月17日

#### **1. 项目愿景 (Project Vision)**

构建一个集中式、安全、可扩展的用户门户平台。该平台旨在为所有未来的前端应用（"1+N"模式）提供统一的用户认证（Authentication）、授权（Authorization）以及导航服务。同时，为管理员提供一个强大的后台，用于管理用户、角色、权限，并监控用户活动，确保系统的安全与可控。

#### **2. 用户角色 (User Roles)**

| 角色 | 描述 | 核心需求 |
| :--- | :--- | :--- |
| **普通用户 (Regular User)** | 系统的主要使用者。他们需要访问一个或多个授权给他们的应用。 | - 能够快速、安全地注册和登录。<br>- 登录后能看到一个清晰的应用导航门户。<br>- 能够方便地访问其有权使用的应用。 |
| **公司级管理员 (Administrator)** | 租户系统的维护者和管理者。他们负责公司级用户和权限的配置，并监控系统状态。 | - 拥有一个独立的、受保护的管理后台。<br>- 能够查看和管理公司范围内的所有用户。<br>- 能够定义角色并为用户分配角色。<br>- 能够配置不同角色的具体权限。<br>- 能够审计和追溯用户的关键活动。 |
| **系统级管理员 (Administrator)** | 系统的维护者和管理者。他们负责用户和权限的配置，并监控系统状态。 | - 拥有一个独立的、受保护的管理后台。<br>- 能够查看和管理所有用户。<br>- 能够定义角色并为用户分配角色。<br>- 能够配置不同角色的具体权限。<br>- 能够审计和追溯用户的关键活动。 |

#### **3. 核心功能模块 (Epics)**

1.  **用户认证系统 (User Authentication):** 提供完整的用户身份验证流程。
2.  **应用门户 (Application Portal):** 用户登录后看到的导航中心。
3.  **管理员后台 (Admin Dashboard):** 用于系统管理的核心界面。
4.  **权限与角色管理 (RBAC):** 实现基于角色的访问控制。
5.  **用户活动日志 (Activity Logging):** 记录关键的用户行为。

#### **4. 功能详述 (User Stories)**

**Epic 1: 用户认证系统**
*   **注册:** 作为一个新用户，我希望能通过邮箱和密码创建一个新账户，以便使用平台服务。
*   **登录:** 作为一个已注册用户，我希望能使用我的邮箱和密码进行登录，以便访问我的应用门户。
*   **登出:** 作为一个已登录用户，我希望能安全地退出登录，以保护我的账户安全。
*   **会话管理:** 作为一个已登录用户，我希望系统能保持我的登录状态，这样我就不必在每次访问时都重新登录。
*   **路由保护:** 作为一个未登录用户，当我尝试访问需要登录的页面（如应用门户）时，系统应将我自动重定向到登录页面。

**Epic 2: 应用门户**
*   **导航视图:** 作为一个已登录用户，我希望能看到一个清晰的仪表盘或导航栏，其中列出了所有我被授权访问的应用。
*   **应用访问:** 作为一个已登录用户，我希望能通过点击应用链接或卡片，无缝地跳转到对应的应用。

**Epic 3: 管理员后台**
*   **后台访问:** 作为一个管理员，我希望能访问一个与普通用户门户隔离的管理后台，入口应清晰可辨。
*   **用户列表:** 作为一个管理员，我希望能在后台看到一个包含所有注册用户的列表，并能看到他们的基本信息（如邮箱、角色、注册时间）。
*   **用户搜索与分页:** 作为一个管理员，当用户数量很多时，我希望能通过搜索和分页功能快速找到特定的用户。

**Epic 4: 权限与角色管理 (RBAC)**
*   **角色分配:** 作为一个管理员，我希望能为任何一个用户分配一个角色（例如，将其从 'USER' 提升为 'ADMIN'）。
*   **权限控制:**
    *   系统必须能根据用户的角色来限制其访问。例如，只有 'ADMIN' 角色的用户才能访问管理员后台。
    *   （未来）作为一个管理员，我希望能创建新的角色，并为这些角色勾选/取消勾选精细化的权限点（如 `can_delete_user`, `can_view_logs`）。

**Epic 5: 用户活动日志**
*   **日志记录:** 系统应自动记录关键的用户活动，例如：用户登录成功、用户注册、管理员修改了用户角色等。
*   **日志查看:** 作为一个管理员，我希望能在后台查看一个按时间倒序排列的活动日志列表。
*   **日志筛选:** 作为一个管理员，我希望能按用户或事件类型筛选日志，以便进行快速审计。

#### **5. 非功能性需求 (Non-Functional Requirements)**

*   **安全性 (Security):**
    *   用户密码必须经过哈希加盐处理后才能存入数据库。
    *   必须采取措施防止常见的 Web 漏洞（如 XSS, CSRF）。
    *   会话管理必须安全可靠。
*   **可扩展性 (Scalability):**
    *   项目必须采用 Monorepo 架构，以便未来能轻松地在 `apps/` 目录下添加新的独立应用。
    *   所有跨应用共享的逻辑（如UI组件、数据库访问、认证逻辑）都应被抽取到 `packages/` 目录下，以实现最大化的代码复用。
*   **代码质量 (Code Quality):**
    *   整个项目必须使用 TypeScript 编写，以保证类型安全。
    *   必须配置统一的 ESLint 和 Prettier 规则，以确保代码风格一致。

#### **6. 技术栈与架构 (Tech Stack & Architecture)**

*   **架构:** **Monorepo** (使用 **Turborepo** + **pnpm workspaces** 进行管理)
*   **核心框架:** **Next.js 14+** (使用 App Router)
*   **数据库 ORM:** **Prisma**
*   **数据库:** **SQLite** (便于开发，可轻松替换为 PostgreSQL/MySQL)
*   **认证:** **Auth.js (NextAuth v5)**
*   **UI:** **antd V6**  (用于快速构建美观的界面)
